"use strict";

var app = angular.module("SuperAdmin", []);

app.controller("SuperAdminController", function ($scope, $http) {

    var self = $scope;

    self.sec = -1;
    self.newProfAc = true;
    self.alumUsers = [];
    self.profUsers = [];
    self.selectedUser = null;
    self.search = "";

    self.setSec = function (idx) {
        self.sec = idx;
        if (idx == 0) self.getStats();
    };

    self.getStats = function () {
        $http.get("stats").success(function (data) {
            self.sts = {
                alive: data.check.ping,
                memory: data.memory.process.heapUsed / 1024 / 1024,
                cpu: data.cpu["1m"][0],
                uptime: data.uptime.process
            };
        });
    };

    self.getUsers = function () {
        $http.post("/get-all-users").success(function (data) {
            self.alumUsers = data.filter(function (e) {
                return e.role == "A";
            });
            self.profUsers = data.filter(function (e) {
                return e.role == "P";
            });
        });
    };

    self.convertUser = function () {
        var postdata = {
            uid: self.selectedUser
        };
        $http.post("/convert-prof", postdata).success(function (data) {
            self.getUsers();
            alert("Profesor creado correctamente");
        });
    };

    self.removeProf = function (uid) {
        if (!window.confirm("Estas seguro de eliminar la cuenta de profesor?")) return;
        var postdata = {
            uid: uid
        };
        $http.post("/remove-prof", postdata).success(function (data) {
            self.getUsers();
            alert("Profesor eliminado correctamente");
        });
    };

    self.selectUser = function (uid) {
        self.selectedUser = uid;
    };

    self.superLogin = function (uid) {
        if (!window.confirm("Estas seguro de entrar como la cuenta de profesor?")) return;
        var postdata = {
            uid: uid
        };
        $http.post("/super-login-as", postdata).success(function (data) {
            window.location.replace("/");
        });
    };

    self.getUsers();
});
